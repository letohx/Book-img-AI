<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book img AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f0f5;
            display: flex;
            justify-content: center;
        }

        .wrapper {
            text-align: center;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
        }

        h1 {
            font-size: 2.2rem;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        textarea, select, input[type="number"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        button {
            width: 100%;
            padding: 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #2980b9;
        }

        img {
            margin-top: 20px;
            max-width: 100%;
            height: auto;
            display: block;
            margin-left: auto;
            margin-right: auto;
            cursor: pointer;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            font-size: 1.2rem;
            margin-bottom: 5px;
            display: block;
        }

        .size-img {
            display: flex;
            justify-content: space-evenly;
        }

    </style>
    <script src="https://code.responsivevoice.org/responsivevoice.js"></script>
    <script>
        const key = "CB877DFF3660DE7C80599E533C090123";
        const secret = "4A329B2763F032D01B680EF8C1E3F23D";
        let prd = null;
        let uuid = '';
        let currentIndex = 0;

        function headers() {
            return {
                'X-Key': 'Key ' + key,
                'X-Secret': 'Secret ' + secret,
            };
        }

        function params() {
            return {
                type: "GENERATE",
                style: style.value,
                width: width.value,
                height: height.value,
                num_images: 1,
                negativePromptUnclip: "",
                generateParams: {
                    query: document.getElementById('summaryText').innerText,
                }
            };
        }

        async function generate() {
            try {
                let model_id = 0;
                let res = await fetch('https://api-key.fusionbrain.ai/key/api/v1/models', {
                    method: 'GET',
                    headers: headers(),
                });
                const models = await res.json();
                model_id = models[0]?.id;

                if (!model_id) {
                    console.error('Model ID not found');
                    return;
                }

                let formData = new FormData();
                formData.append('model_id', model_id);
                formData.append('params', new Blob([JSON.stringify(params())], { type: "application/json" }));

                let imageResponse = await fetch('https://api-key.fusionbrain.ai/key/api/v1/text2image/run', {
                    method: 'POST',
                    headers: headers(),
                    body: formData,
                });
                let imageResult = await imageResponse.json();
                uuid = imageResult.uuid;

                if (!uuid) {
                    console.error('UUID not generated');
                    return;
                }

                prd = setInterval(check, 3000);
            } catch (error) {
                console.error('Error generating image:', error);
            }
        }

        async function check() {
            try {
                let res = await fetch('https://api-key.fusionbrain.ai/key/api/v1/text2image/status/' + uuid, {
                    method: 'GET',
                    headers: headers(),
                });
                let json = await res.json();

                if (json.status === 'DONE') {
                    document.getElementById('img').src = 'data:image/jpeg;charset=utf-8;base64,' + json.images[0];
                    clearInterval(prd);
                } else if (json.status === 'ERROR') {
                    console.error('Error in image generation');
                    clearInterval(prd);
                }
            } catch (error) {
                console.error('Error checking image status:', error);
            }
        }

        function autoSetSize() {
            let screenWidth = screen.width;
            let screenHeight = screen.height;
            document.getElementById('width').value = screenWidth;
            document.getElementById('height').value = screenHeight;
        }

        async function summarizeText(text) {
            const summaryText = document.getElementById('summaryText');
            summaryText.innerText = '';

            try {
                const response = await fetch('/.netlify/functions/summarize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });

                const data = await response.json();
                summaryText.innerText = data.summary;
                generate(); // Запуск генерации изображения после сокращения текста
            } catch (error) {
                summaryText.innerText = `Error processing your request.`;
            }
        }

        function speakNext() {
            const text = document.getElementById('textToSpeak').value;
            const voice = document.getElementById('voiceselection').value;
            const wordCount = parseInt(document.getElementById('wordCount').value);
            const words = text.split(/\s+/);

            if (currentIndex >= words.length) {
                alert("End of text.");
                return;
            }

            const nextWords = words.slice(currentIndex, currentIndex + wordCount).join(' ');
            document.getElementById('currentText').value = nextWords;

            summarizeText(nextWords); // Сокращаем текст перед озвучиванием

            responsiveVoice.speak(nextWords, voice, {
                onend: () => {
                    currentIndex += wordCount;
                    speakNext(); // Продолжаем озвучивание следующей порции
                }
            });
        }

        function startCycle() {
            currentIndex = 0; // Сбрасываем индекс при новом запуске
            speakNext(); // Начинаем озвучивание и сокращение
        }

        window.onload = async () => {
            let res = await fetch('https://cdn.fusionbrain.ai/static/styles/web');
            res = await res.json();
            for (let style of res) {
                document.getElementById('style').innerHTML += `<option value="${style.name}">${style.name}</option>`;
            }

            const imgElement = document.getElementById('img');
            imgElement.addEventListener('click', function () {
                if (!document.fullscreenElement) {
                    if (this.requestFullscreen) {
                        this.requestFullscreen();
                    } else if (this.mozRequestFullScreen) {
                        this.mozRequestFullScreen();
                    } else if (this.webkitRequestFullscreen) {
                        this.webkitRequestFullscreen();
                    } else if (this.msRequestFullscreen) {
                        this.msRequestFullscreen();
                    }
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.mozCancelFullScreen) {
                        document.mozCancelFullScreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                }
            });
        }
    </script>
</head>
<body>
    <div class="wrapper">
        <h1>Book Image AI</h1>
        <div class="input-group">
            <textarea id="textToSpeak" rows="8" placeholder="Enter text here...">
                В некотором царстве, в некотором государстве жил-был царь, и было у него три сына. Младшего звали Иван-царевич.

Позвал однажды царь сыновей и говорит им:

— Дети мои милые, вы теперь все на возрасте, пора вам и о невестах подумать!

— За кого же нам, батюшка, посвататься?

— А вы возьмите по стреле, натяните свои тугие луки и пустите стрелы в разные стороны. Где стрела упадет — там и сватайтесь.

Вышли братья на широкий отцовский двор, натянули свои тугие луки и выстрелили.

Пустил стрелу старший брат. Упала стрела на боярский двор, и подняла ее боярская дочь.

Пустил стрелу средний брат — полетела стрела к богатому купцу во двор. Подняла ее купеческая дочь.

Пустил стрелу Иван-царевич — полетела его стрела прямо в топкое болото, и подняла ее лягушка-квакушка…Царевна-лягушка

Старшие братья как пошли искать свои стрелы, сразу их нашли: один — в боярском тереме, другой — на купеческом дворе. А Иван-царевич долго не мог найти свою стрелу. Два дня ходил он по лесам и по горам, а на третий день зашел в топкое болото. Смотрит — сидит там лягушка-квакушка, его стрелу держит.

Царевна-лягушка, фото 2

Иван-царевич хотел было бежать и отступиться от своей находки, а лягушка и говорит:

— Ква-ква, Иван-царевич! Поди ко мне, бери свою стрелу, а меня возьми замуж.

Царевна-лягушка, фото 3

Опечалился Иван-царевич и отвечает:

— Как же я тебя замуж возьму? Меня люди засмеют!

— Возьми, Иван-царевич, жалеть не будешь!

Царевна-лягушка, фото 4

Подумал-подумал Иван-царевич, взял лягушку-квакушку, завернул ее в платочек и принес в свое царство-государство.

Пришли старшие братья к отцу, рассказывают, куда чья стрела попала.

Рассказал и Иван-царевич. Стали братья над ним смеяться, а отец говорит:

— Бери квакушку, ничего не поделаешь!

Вот сыграли три свадьбы, поженились царевичи: старший царевич — на боярышне, средний — на купеческой дочери, а Иван-царевич — на лягушке-квакушке.

На другой день после свадьбы призвал царь своих сыновей и говорит:

— Ну, сынки мои дорогие, теперь вы все трое женаты. Хочется мне узнать, умеют ли ваши жены хлебы печь. Пусть они к утру испекут мне по караваю хлеба.

Поклонились царевичи отцу и пошли. Воротился Иван-царевич в свои палаты невесел, ниже плеч буйну голову повесил.

— Ква-ква, Иван-царевич, — говорит лягушка-квакушка, — что ты так опечалился? Или услышал от своего отца слово неласковое?

— Как мне не печалиться! — отвечает Иван-царевич. — Приказал мой батюшка, чтобы ты сама испекла к утру каравай хлеба…

— Не тужи, Иван-царевич! Ложись-ка лучше спать-почивать: утро вечера мудренее!

Уложила квакушка царевича спать, а сама сбросила с себя лягушечью кожу и обернулась красной девицей Василисой Премудрой — такой красавицей, что ни в сказке сказать, ни пером описать!

Взяла она частые решета, мелкие сита, просеяла муку пшеничную, замесила тесто белое, испекла каравай — рыхлый да мягкий, изукрасила каравай разными узорами мудреными: по бокам — города с дворцами, садами да башнями, сверху — птицы летучие, снизу — звери рыскучие…

Утром будит квакушка Ивана-царевича:

— Пора, Иван-царевич, вставай, каравай неси!

Положила каравай на золотое блюдо, проводила Ивана-царевича к отцу.

Пришли и старшие братья, принесли свои караваи, только у них и посмотреть не на что: у боярской дочки хлеб подгорел, у купеческой — сырой да кособокий получился.

Царь сначала принял каравай у старшего царевича, взглянул на него и приказал отнести псам дворовым.

Принял у среднего, взглянул и сказал:

— Такой каравай только от большой нужды есть будешь!

Дошла очередь и до Ивана-царевича. Принял царь от него каравай и сказал:

— Вот этот хлеб только в большие праздники есть!

И тут же дал сыновьям новый приказ:

— Хочется мне знать, как умеют ваши жены рукодельничать. Возьмите шелку, золота и серебра, и пусть они своими руками за ночь выткут мне по ковру!

Вернулись старшие царевичи к своим женам, передали им царский приказ. Стали жены кликать мамушек, нянюшек и красных девушек — чтобы пособили им ткать ковры. Тотчас мамушки, нянюшки да красные девушки собрались и принялись ковры ткать да вышивать — кто серебром, кто золотом, кто шелком.

А Иван-царевич воротился домой невесел, ниже плеч буйну голову повесил.

— Ква-ква, Иван-царевич, — говорит лягушка-квакушка, — почему так печалишься? Или услышал от отца своего слово недоброе?

— Как мне не кручиниться! — отвечает Иван-царевич. — Батюшка приказал за одну ночь соткать ему ковер узорчатый!

— Не тужи, Иван-царевич! Ложись-ка лучше спать-почивать: утро вечера мудренее!

Уложила его квакушка спать, а сама сбросила с себя лягушечью кожу, обернулась красной девицей Василисой Премудрой и стала ковер ткать. Где кольнет иглой раз — цветок зацветет, где кольнет другой раз — хитрые узоры идут, где кольнет третий — птицы летят…

Солнышко еще не взошло, а ковер уж готов.

Вот пришли все три брата к царю, принесли каждый свой ковер. Царь прежде взял ковер у старшего царевича, посмотрел и молвил:

— Этим ковром только от дождя лошадей покрывать!

Принял от среднего, посмотрел и сказал:

— Только у ворот его стелить!

Принял от Ивана-царевича, взглянул и сказал:

— А вот этот ковер в моей горнице по большим праздникам расстилать!

И тут же отдал царь новый приказ, чтобы все три царевича явились к нему на пир со своими женами: хочет царь посмотреть, которая из них лучше пляшет.

Отправились царевичи к своим женам.

Идет Иван-царевич, печалится, сам думает: «Как поведу я мою квакушку на царский пир?..»

Пришел он домой невеселый. Спрашивает его квакушка:

— Что опять, Иван-царевич, невесел, ниже плеч буйну голову повесил? О чем запечалился?

— Как мне не печалиться! — говорит Иван-царевич. — Батюшка приказал, чтобы я тебя завтра к нему на пир привез…

— Не горюй, Иван-царевич! Ложись-ка да спи: утро вечера мудренее!

На другой день, как пришло время ехать на пир, квакушка и говорит царевичу:

— Ну, Иван-царевич, отправляйся один на царский пир, а я вслед за тобой буду. Как услышишь стук да гром — не пугайся, скажи: «Это, видно, моя лягушонка в коробчонке едет!»

Пошел Иван-царевич к царю на пир один.

А старшие братья явились во дворец со своими женами, разодетыми, разубранными. Стоят да над Иваном-царевичем посмеиваются:

— Что же ты, брат, без жены пришел? Хоть бы в платочке ее принес, дал бы нам всем послушать, как она квакает!

Вдруг поднялся стук да гром — весь дворец затрясся-зашатался. Все гости переполошились, повскакали со своих мест. А Иван-царевич говорит:

— Не бойтесь, гости дорогие! Это, видно, моя лягушонка в своей коробчонке едет!

Подбежали все к окнам и видят: бегут скороходы, скачут гонцы, а вслед за ними едет золоченая карета, тройкой гнедых коней запряжена.

Подъехала карета к крыльцу, и вышла из нее Василиса Премудрая — сама как солнце ясное светится.

Все на нее дивятся, любуются, от удивления слова вымолвить не могут.

Взяла Василиса Премудрая Ивана-царевича за руки и повела за столы дубовые, за скатерти узорчатые…

Стали гости есть, пить, веселиться.

Василиса Премудрая из кубка пьет — не допивает, остатки себе за левый рукав выливает. Лебедя жареного ест — косточки за правый рукав бросает.

Жены старших царевичей увидели это — и туда же: чего не допьют — в рукав льют, чего не доедят — в другой кладут. А к чему, зачем — того и сами не знают.

Как встали гости из-за стола, заиграла музыка, начались пляски. Пошла Василиса Премудрая плясать с Иваном-царевичем. Махнула левым рукавом — стало озеро, махнула правым — поплыли по озеру белые лебеди. Царь и все гости диву дались. А как перестала она плясать, все исчезло: и озеро и лебеди.

Пошли плясать жены старших царевичей.

Как махнули своими левыми рукавами — всех гостей забрызгали; как махнули правыми — костями-огрызками осыпали, самому царю костью чуть глаз не выбили. Рассердился царь и приказал их выгнать вон из горницы.

Когда пир был на исходе, Иван-царевич улучил минутку и побежал домой. Разыскал лягушечью кожу и спалил ее на огне.

Приехала Василиса Премудрая домой, хватилась — нет лягушечьей кожи! Бросилась она искать ее. Искала, искала — не нашла и говорит Ивану-царевичу:

— Ах, Иван-царевич, что же ты наделал! Если бы ты еще три дня подождал, я бы вечно твоею была. А теперь прощай, ищи меня за тридевять земель, за тридевять морей, в тридесятом царстве, в подсолнечном государстве, у Кощея Бессмертного. Как три пары железных сапог износишь, как три железных хлеба изгрызешь — только тогда и разыщешь меня…

Сказала, обернулась белой лебедью и улетела в окно.

Загоревал Иван-царевич. Снарядился, взял лук да стрелы, надел железные сапоги, положил в заплечный мешок три железных хлеба и пошел искать жену свою, Василису Премудрую.

Долго ли шел, коротко ли, близко ли, далеко ли — скоро сказка сказывается, да не скоро дело делается, — две пары железных сапог износил, два железных хлеба изгрыз, за третий принялся. И повстречался ему тогда старый старик.

— Здравствуй, дедушка! — говорит Иван-царевич.

— Здравствуй, добрый молодец! Чего ищешь, куда путь держишь?

Рассказал Иван-царевич старику свое горе.

— Эх, Иван-царевич, — говорит старик, — зачем же ты лягушечью кожу спалил? Не ты ее надел, не тебе ее и снимать было!

Василиса Премудрая хитрей-мудрей отца своего, Кощея Бессмертного, уродилась, он за то разгневался на нее и приказал ей три года квакушею быть. Ну, да делать нечего, словами беды не поправишь. Вот тебе клубочек: куда он покатится, туда и ты иди.

Иван-царевич поблагодарил старика и пошел за клубочком.

Катится клубочек по высоким горам, катится по темным лесам, катится по зеленым лугам, катится по топким болотам, катится по глухим местам, а Иван-царевич все идет да идет за ним — не остановится на отдых ни на часок.

Шел-шел, третью пару железных сапог истер, третий железный хлеб изгрыз и пришел в дремучий бор. Попадается ему навстречу медведь.

«Дай убью медведя! — думает Иван-царевич. — Ведь у меня никакой еды больше нет».

Прицелился он, а медведь вдруг и говорит ему человеческим голосом:

— Не убивай меня, Иван-царевич! Когда-нибудь я пригожусь тебе.

Не тронул Иван-царевич медведя, пожалел, пошел дальше.

Идет он чистым полем, глядь — а над ним летит большой селезень.

Иван-царевич натянул лук, хотел было пустить в селезня острую стрелу, а селезень и говорит ему по-человечески:

— Не убивай меня, Иван-царевич! Будет время — я тебе пригожусь.

Пожалел Иван-царевич селезня — не тронул его, пошел дальше голодный.

Вдруг бежит навстречу ему косой заяц.

«Убью этого зайца! — думает царевич. — Очень уж есть хочется…»

Натянул свой тугой лук, стал целиться, а заяц говорит ему человеческим голосом:

— Не губи меня, Иван-царевич! Будет время — я тебе пригожусь.

И его пожалел царевич, пошел дальше.

Вышел он к синему морю и видит: на берегу, на желтом песке, лежит щука-рыба. Говорит Иван-царевич:

— Ну, сейчас эту щуку съем! Мочи моей больше нет — так есть хочется!

— Ах, Иван-царевич, — молвила щука, — сжалься надо мной, не ешь меня, брось лучше в синее море!

Сжалился Иван-царевич над щукой, бросил ее в море, а сам пошел берегом за своим клубочком.

Долго ли, коротко ли — прикатился клубочек в лес, к избушке. Стоит та избушка на курьих ножках, кругом себя поворачивается.

Говорит Иван-царевич:

— Избушка, избушка, повернись к лесу задом, ко мне передом!

Избушка по его слову повернулась к лесу задом, а к нему передом. Вошел Иван-царевич в избушку и видит: лежит на печи баба-яга — костяная нога. Увидела она царевича и говорит:

— Зачем ко мне пожаловал, добрый молодец? Волей или неволей?

— Ах, баба-яга — костяная нога, ты бы меня накормила прежде, напоила да в бане выпарила, тогда бы и выспрашивала!

— И то правда! — отвечает баба-яга.

Накормила она Ивана-царевича, напоила, в бане выпарила, а царевич рассказал ей, что он ищет жену свою, Василису Премудрую.

— Знаю, знаю! — говорит баба-яга. — Она теперь у злодея Кощея Бессмертного. Трудно будет ее достать, нелегко с Кощеем сладить: его ни стрелой, ни пулей не убьешь. Потому он никого и не боится.

— Да есть ли где его смерть?

— Его смерть — на конце иглы, та игла — в яйце, то яйцо — в утке, та утка — в зайце, тот заяц — в кованом ларце, а тот ларец — на вершине старого дуба. А дуб тот в дремучем лесу растет.

Рассказала баба-яга Ивану-царевичу, как к тому дубу пробраться. Поблагодарил ее царевич и пошел.

Долго он по дремучим лесам пробирался, в топях болотных вяз и пришел наконец к Кощееву дубу. Стоит тот дуб, вершиной в облака упирается, корни на сто верст в земле раскинул, ветками красное солнце закрыл. А на самой его вершине — кованый ларец.

Смотрит Иван-царевич на дуб и не знает, что ему делать, как ларец достать.

«Эх, — думает, — где-то медведь? Он бы мне помог!»

Только подумал, а медведь тут как тут: прибежал и выворотил дуб с корнями. Ларец упал с вершины и разбился на мелкие кусочки.

Выскочил из ларца заяц и пустился наутек.

«Где-то мой заяц? — думает царевич. — Он этого зайца непременно догнал бы…»

Не успел подумать, а заяц тут как тут: догнал другого зайца, ухватил и разорвал пополам. Вылетела из того зайца утка и поднялась высоко-высоко в небо.

«Где-то мой селезень?» — думает царевич.

А уж селезень за уткой летит — прямо в голову клюет. Выронила утка яйцо, и упало то яйцо в синее море…

Загоревал Иван-царевич, стоит на берегу и говорит:

— Где-то моя щука? Она достала бы мне яйцо со дна морского!

Вдруг подплывает к берегу щука-рыба и держит в зубах яйцо.

— Получай, Иван-царевич!

Обрадовался царевич, разбил яйцо, достал иглу и отломил у нее кончик. И только отломил — умер Кощей Бессмертный, прахом рассыпался.

Пошел Иван-царевич в Кощеевы палаты. Вышла тут к нему Василиса Премудрая и говорит:

— Ну, Иван-царевич, сумел ты меня найти, теперь я весь век твоя буду!

Выбрал Иван-царевич лучшего скакуна из Кощеевой конюшни, сел на него с Василисой Премудрой и воротился в свое царство-государство.

И стали они жить дружно, в любви и согласии.
            </textarea>
            <textarea id="currentText" rows="5" readonly></textarea>

            <label for="wordCount">Number of words at a time:</label>
            <input type="number" id="wordCount" min="1" value="50">

            <label for="voiceselection">Choose voice:</label>
            <select id="voiceselection">
                <option value="Russian Female">Russian Female</option>
                <option value="Russian Male">Russian Male</option>
                <option value="UK English Female">UK English Female</option>
                <option value="UK English Male">UK English Male</option>
                <option value="US English Female">US English Female</option>
                <option value="US English Male">US English Male</option>
                <option value="Polish Male">Polish Male</option>
                <option value="Polish Female">Polish Female</option>
                <option value="Romanian Female">Romanian Female</option>
                <option value="Slovak Female">Slovak Female</option>
                <option value="Ukrainian Female">Ukrainian Female</option>
                <option value="Serbo-Croatian Male">Serbo-Croatian Male</option>
                <option value="Bosnian Male">Bosnian Male</option>
            </select>

            <div class="size-img">
                <div class="input-group">
                    <label>Width</label>
                    <input id="width" type="number" value="1920" size="5">
                </div>
    
                <div class="input-group">
                    <label>Height</label>
                    <input id="height" type="number" value="1080" size="5">
                </div>
            </div>

            <button onclick="autoSetSize()">Auto size image</button>
            <div class="input-group">
                <label>Style image</label>
                <select id="style"></select>
            </div>

            <button onclick="startCycle()">Start</button>
            <div id="summaryText"></div><br>
        </div>

        <img src="https://www.research.autodesk.com/app/uploads/2023/01/ai.jpg" id="img" title="Generated image">
    </div>
</body>
</html>
